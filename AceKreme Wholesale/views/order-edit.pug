extends layout.pug

block content
  h2 Edit Order

  if order
    form(action=`/admin/orders/edit/${order._id}?_method=PUT`, method='POST')
      label(for='customer') Customer:
      select(id='customer', name='customer', required)
        option(value='') Select a Customer
        - var selectedCustomerId = '';
        - if (order.customer && typeof order.customer === 'object' && order.customer._id) {
        -   selectedCustomerId = order.customer._id.toString();
        - } else if (order.customer) {
        -   selectedCustomerId = order.customer.toString();
        - }
        each customerOption in customers
          option(
            value=customerOption._id,
            selected=(customerOption._id.toString() === selectedCustomerId)
          ) #{customerOption.firstName} #{customerOption.lastName} (#{customerOption.email})

      label(for='orderDate') Order Date:
      input(
        type='date',
        id='orderDate',
        name='orderDate',
        value=formatDateForInput(order.orderDate),
        required
      )

      label(for='products') Products (JSON Array of {productId, quantity, priceAtOrder}):
      textarea(id='products', name='products', rows='8', required)= JSON.stringify(order.products, null, 2)

      label(for='totalAmount') Total Amount:
      input(type='number', id='totalAmount', name='totalAmount', step='0.01', min='0', value=order.totalAmount, required)

      label(for='status') Status:
      select(id='status', name='status', required)
        option(value='Pending', selected=(order.status === 'Pending')) Pending
        option(value='Processing', selected=(order.status === 'Processing')) Processing
        option(value='Shipped', selected=(order.status === 'Shipped')) Shipped
        option(value='Delivered', selected=(order.status === 'Delivered')) Delivered
        option(value='Cancelled', selected=(order.status === 'Cancelled')) Cancelled

      label(for='shippingAddress') Shipping Address:
      input(type='text', id='shippingAddress', name='shippingAddress', value=order.shippingAddress)

      label(for='trackingNumber') Tracking Number:
      input(type='text', id='trackingNumber', name='trackingNumber', value=order.trackingNumber)

      button(type='submit') Update Order
      a(href='/admin/orders', class='button-link cancel-button') Cancel
  else
    p Order not found for editing.